<!doctype html>
<html class="docs-version-current" lang="fr" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.7">
<link rel="alternate" type="application/rss+xml" href="/news/rss.xml" title="Les Moddeurs Francais RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/news/atom.xml" title="Les Moddeurs Francais Atom Feed">
<link rel="icon" href="/img/logo.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(36, 37, 38)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/logo.png">
<link rel="mask-icon" href="img/logo" color="rgb(116, 120, 124)">
<meta name="msapplication-TileImage" content="/img/logo.png">
<meta name="msapplication-TileColor" content="#000"><title data-react-helmet="true">Dist Executor | Les Moddeurs Francais</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://forge-doc.lesmoddeursfrancais.fr/docs/advanced/dist-executor"><meta data-react-helmet="true" name="docusaurus_locale" content="fr"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Dist Executor | Les Moddeurs Francais"><meta data-react-helmet="true" name="description" content="Comment utiliser les dist executors ?"><meta data-react-helmet="true" property="og:description" content="Comment utiliser les dist executors ?"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://forge-doc.lesmoddeursfrancais.fr/docs/advanced/dist-executor"><link data-react-helmet="true" rel="alternate" href="https://forge-doc.lesmoddeursfrancais.fr/docs/advanced/dist-executor" hreflang="fr"><link data-react-helmet="true" rel="alternate" href="https://forge-doc.lesmoddeursfrancais.fr/docs/advanced/dist-executor" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.977700f3.css">
<link rel="preload" href="/assets/js/runtime~main.f2806c10.js" as="script">
<link rel="preload" href="/assets/js/main.f90c44be.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Aller au contenu principal</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="LMF Logo Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo.png" alt="LMF Logo Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Les Moddeurs Francais</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Documentation</a><a class="navbar__item navbar__link" href="/faq/intro">FAQ</a><a class="navbar__item navbar__link" href="/news">News</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Les-Moddeurs-Francais/Forge-Doc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">üåú</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">üåû</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Bases</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Enregistrement</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Items</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Blocs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Data Generators</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Avanc√©</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/advanced/access-transformer">Access Transformer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/advanced/dist-executor">Dist Executor</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">Sur cette page</button></div><div class="theme-doc-markdown markdown"><header><h1>Dist Executor</h1></header><h2 class="anchor anchorWithStickyNavbar_31ik" id="introduction">Introduction<a aria-hidden="true" class="hash-link" href="#introduction" title="Lien direct vers le titre">‚Äã</a></h2><p>Le syst√®me de <code>Dist Executor</code> est une API efficace fournie par <strong>FML</strong> situ√©e dans le projet <code>fmlcore</code> permettant de g√©rer le code ne devant s&#x27;ex√©cuter que sur une <code>Dist</code> particuli√®re. Ce syst√®me a √©t√© ajout√© en remplacement du syst√®me de <code>SidedProxy</code>, pr√©sent lors des anciennes versions de <strong>Forge</strong> (1.12.2 et avant).</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="cest-quoi-une-dist-">C&#x27;est quoi une <code>Dist</code> ?<a aria-hidden="true" class="hash-link" href="#cest-quoi-une-dist-" title="Lien direct vers le titre">‚Äã</a></h2><p>Une <code>Dist</code> repr√©sente sur quel &quot;c√¥t√©&quot;, sur quel distribution de Minecraft doit s&#x27;ex√©cuter ce code. Ces distributions sont repr√©sent√©es dans l&#x27;√©num√©ration <code>net.minecraftforge.api.distmarker.Dist</code>. Aujourd&#x27;hui, il existe 2 distributions :</p><ul><li><code>CLIENT</code> : La distribution du client. Il s&#x27;agit du client avec lequel les joueurs jouent. Il g√®re la partie rendu/graphique du jeu.</li><li><code>DEDICATED_SERVER</code> : La distribution du serveur d√©di√©. Il s&#x27;agit de la distribution r√©serv√©e aux serveurs. Il g√®re le monde ainsi que quelques √©l√©ments logiques, et communique avec le client via le r√©seau. Il ne contient aucun √©l√©ment visuel du jeu.</li></ul><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>La distribution <code>DEDICATED_SERVER</code> n&#x27;est pas utilis√©e lors de l&#x27;ex√©cution du serveur int√©gr√© lanc√© en solo.</p></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="lannotation-onlyin">L&#x27;annotation <code>@OnlyIn</code><a aria-hidden="true" class="hash-link" href="#lannotation-onlyin" title="Lien direct vers le titre">‚Äã</a></h2><p>L&#x27;annotation <code>@OnlyIn</code> permet d&#x27;indiquer √† <strong>FML</strong> de charger ou non le membre annot√© en fonction de la <code>Dist</code> sp√©cifi√©e en param√®tre. Tout comme l&#x27;√©num√©ration <code>Dist</code>, elle se situe dans le package <code>net.minecraftforge.api.distmarker</code>. Elle peut-√™tre utilis√©e sur les classes, les champs, les m√©thodes, les constructeurs, les packages et les annotations. Pour information, cette annotation est trait√©e dans la classe <code>RuntimeDistCleaner</code> du projet <code>fmlloader</code>. L&#x27;annotation <code>@OnlyIns</code> ne sera pas trait√© dans ce tutoriel.</p><p>Si on tente d&#x27;appeler un membre depuis une autre <code>Dist</code>, le membre sera consid√©r√© comme inexistant et des erreurs comme <code>NoSuchFieldError</code>, <code>NoSuchMethodError</code> ou encore <code>ClassNotFoundException</code> peuvent survenir en fonction du type du membre.</p><p>Par exemple :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">package fr.lmf.distexecutor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.minecraftforge.api.distmarker.Dist;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.minecraftforge.api.distmarker.OnlyIn;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@OnlyIn(Dist.CLIENT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OnlyClientClass {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Object aField;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void aMethod() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // do something</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copier le code" class="copyButton_Ue-o clean-btn">Copier</button></div></div><p>La classe ne sera charg√©e que sur le client. Si elle est appel√©e sur le serveur, une erreur sera propag√©e.</p><p>En revanche, une m√™me classe par exemple peut contenir des membres reli√©s √† des <code>Dist</code>s diff√©rentes.
Exemple :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">package fr.lmf.distexecutor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.minecraftforge.api.distmarker.Dist;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.minecraftforge.api.distmarker.OnlyIn;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SimpleClass {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @OnlyIn(Dist.CLIENT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Object aField;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @OnlyIn(Dist.DEDICATED_SERVER)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void aMethod() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // do something</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copier le code" class="copyButton_Ue-o clean-btn">Copier</button></div></div><p>Ici, la classe sera charg√©e, quelque soit la distribution, mais le field <code>aField</code> sera inexistant sur serveur et de m√™me pour la m√©thode <code>aMethod</code> sur le client. Si nous ex√©cutons <code>System.out.println(this.aField);</code> dans la m√©thode <code>aMethod</code>, le jeu plantera.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="la-classe-distexecutor">La classe <code>DistExecutor</code><a aria-hidden="true" class="hash-link" href="#la-classe-distexecutor" title="Lien direct vers le titre">‚Äã</a></h2><p>Maintenant, vous aimeriez peut-√™tre savoir comment appeler une classe, une m√©thode ou quoi que ce soit en fonction de la <code>Dist</code> pour √©viter les erreurs √©voqu√©es plus haut ?
Utiliser la reflection pour voir si la classe <code>net.minecraft.client.Minecraft</code> (uniquement pr√©sente sur le client) existe serait une solution ; h√©las les limitations de <strong>FML</strong> nous en emp√™che : une erreur est propag√©e et ferme le jeu automatiquement avant m√™me que nouis puissons ex√©cuter du code. De toute fa√ßon, ce n&#x27;est pas la m√©thode propre et recommand√©e que nous recommande <strong>Forge</strong>.</p><p>La classe <code>DistExecutor</code> entre maintenant en jeu. Elle se situe dans le package <code>net.minecraftforge.fml</code> du projet <code>fmlcore</code>. Elle poss√®de quelques m√©thodes statiques utilitaires qui peuvent r√©pondr √† notre probl√©matique.
Nous nous int√©resserons pour le moment qu&#x27;aux m√©thodes <code>(un)safeRunForDist</code> et <code>(un)safeRunWhenOn</code>. Libre √† vous de lire la JavaDoc disponible dans la classe pour conna√Ætre l&#x27;utilit√© de chaque m√©thode. Veillez √† ne pas utiliser - du moins le moins possible - les m√©thodes annot√©es avec l&#x27;annotation <code>@Deprecated</code>.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Les m√©thodes <code>unsafe</code> n&#x27;ex√©cutent pas certaines v√©rifications que les m√©thodes <code>safe</code> appliquent √† l&#x27;ex√©cution du jeu. Nonobstant, ces v√©rifications ne sont pas appliqu√©es en production, quand vous lancer le jeu depuis un launcher par exemple. Vous pouvez donc avoir un plantage en lan√ßant le jeu depuis un environnement de d√©veloppement, et pas en lan√ßant votre jeu de mani√®re classique. Enfin, les m√©thodes <code>unsafe</code> ne peuvent pr√©venir de certaines erreurs comme les <code>ClassCastException</code>.</p></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="la-m√©thode-unsaferunfordist">La m√©thode <code>(un)safeRunForDist</code><a aria-hidden="true" class="hash-link" href="#la-m√©thode-unsaferunfordist" title="Lien direct vers le titre">‚Äã</a></h3><p>La m√©thode <code>(un)safeRunForDist</code> permet de retourner une instance de la classe demand√©e en param√®tre en fonction de la <code>Dist</code>. Par exemple, un syst√®me de &quot;proxy&quot; est facilement reproductible gr√¢ce √† cette m√©thode :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">package fr.lmf.distexecutor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface SidedManager {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void init();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copier le code" class="copyButton_Ue-o clean-btn">Copier</button></div></div><p>Cette interface va nous permettre de d√©finir un membre commun entre nos <code>Manager</code>s : un pour le client, et l&#x27;autre pour le serveur. Voici un exemple d&#x27;impl√©mentation pour le client :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">package fr.lmf.distexecutor.client;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import fr.lmf.distexecutor.SidedManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.minecraftforge.api.distmarker.Dist;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.minecraftforge.api.distmarker.OnlyIn;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.minecraftforge.fml.event.lifecycle.FMLClientSetupEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.minecraftforge.fml.javafmlmod.FMLJavaModLoadingContext;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@OnlyIn(Dist.CLIENT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ClientManager implements SidedManager {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void init() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FMLJavaModLoadingContext.get().getModEventBus().addListener(this::clientSetup);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void clientSetup(FMLClientSetupEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // do something at client startup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copier le code" class="copyButton_Ue-o clean-btn">Copier</button></div></div><p>En voici une autre pour le serveur :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">package fr.lmf.distexecutor.server;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import fr.lmf.distexecutor.SidedManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.minecraftforge.api.distmarker.Dist;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.minecraftforge.api.distmarker.OnlyIn;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.minecraftforge.common.MinecraftForge;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.minecraftforge.eventbus.api.SubscribeEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.minecraftforge.fmlserverevents.FMLServerStartedEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@OnlyIn(Dist.DEDICATED_SERVER)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ServerManager implements SidedManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void init() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MinecraftForge.EVENT_BUS.register(this);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @SubscribeEvent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onServerStart(FMLServerStartedEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // do something at server startup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copier le code" class="copyButton_Ue-o clean-btn">Copier</button></div></div><p>Enfin, il faudra ex√©cuter la bonne m√©thode <code>init</code> au d√©marrage du mod. La m√©thode <code>(un)safeRunForDist</code> prend 2 param√®tres √† signature identiques : un <a href="https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/function/Supplier.html" target="_blank" rel="noopener noreferrer"><code>Supplier</code></a> d&#x27;un <code>(Safe)Supplier</code> de votre classe cible (ici <code>ClientManager</code> ou <code>ServerManager</code>). Un <code>SafeSupplier</code> est une interface fournie par <strong>FML</strong> √©tandant <code>Supplier</code> et <code>SafeReferent</code>. Un <code>SafeReferent</code> est une interface elle aussi fournie par <strong>FML</strong> qui va subir des v√©rifications et propager une erreur si il n&#x27;est pas jug√© &quot;safe&quot;. Les m√©thodes <code>unsafe</code> ne demandent pas de <code>SafeSupplier</code>, remplac√© par un <code>Supplier</code> classique.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">package fr.lmf.distexecutor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import fr.lmf.distexecutor.client.ClientManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import fr.lmf.distexecutor.server.ServerManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.minecraftforge.fml.DistExecutor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.minecraftforge.fml.common.Mod;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Mod(&quot;distexecutorexample&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class DistExecutorMod {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // some fields and constants</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DistExecutorMod() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // do something</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var manager = DistExecutor.unsafeRunForDist(() -&gt; ClientManager::new, () -&gt; ServerManager::new);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        manager.init();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // do something</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // other methods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copier le code" class="copyButton_Ue-o clean-btn">Copier</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Notez l&#x27;utilisation du mot-cl√© <code>var</code>, introduit dans <strong>Java</strong> depuis la version 10. Il d√©tectera automatiquement le type commun de nos deux classes, ici <code>SidedManager</code>. Nous avons donc acc√®s aux m√©thodes dans cette classe, soit <code>init</code> dans le cadre de l&#x27;exemple, libre √† vous d&#x27;en rajouter autant que vous voulez pour les usages de votre choix.</p></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="la-m√©thode-unsaferunwhenon">La m√©thode <code>(un)safeRunWhenOn</code><a aria-hidden="true" class="hash-link" href="#la-m√©thode-unsaferunwhenon" title="Lien direct vers le titre">‚Äã</a></h3><p>Voici une seconde m√©thode qui fonctionne un peu diff√©remment, rassurez vous, vous n&#x27;avez pas besoin de tout recommencer, gardez vos classes <code>ClientManager</code> et <code>ServerManager</code>, vous allez en avoir besoin.</p><p>La m√©thode <code>(un)safeRunWhenOn</code> fonctionne diff√©remment, d√©j√†, elle ne prend pas un ensemble de <code>Supplier</code>, mais une <code>Dist</code> en premier param√®tre et un <code>Supplier</code> d&#x27;un objet <code>(Safe)Runnable</code> (en fonction de si vous utilisez la m√©thode safe ou unsafe). Si la <code>Dist</code> fournie en param√®tre correspond √† la distribution actuelle, le code contenu dans l&#x27;objet <code>(Safe)Runnable</code> sera ex√©cut√©. Par exemple, voici un code qui affichera dans la console &quot;Bonjour depuis le client&quot; sur le client et &quot;Bonjour depuis le serveur&quot; sur le serveur :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">DistExecutor.unsafeRunWhenOn(Dist.CLIENT, () -&gt; () -&gt; System.out.println(&quot;Bonjour depuis le client&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DistExecutor.unsafeRunWhenOn(Dist.DEDICATED_SERVER, () -&gt; () -&gt; System.out.println(&quot;Bonjour depuis le serveur&quot;));</span><br></span></code></pre><button type="button" aria-label="Copier le code" class="copyButton_Ue-o clean-btn">Copier</button></div></div><p>Jusqu&#x27;ici, nos deux <code>Manager</code>s avait la m√™me m√©thode en commun, appel√©e au m√™me moment. En revanche, vous aimeriez pouvoir √™tre plus libre dans l&#x27;utilisation de vos <code>Manager</code>s en ajoutant des m√©thodes ind√©pendantes et pouvant √™tre appel√©es un peu partout comme pouvoir d√©marrer une base de donn√©e depuis le serveur, ou alors ouvrir un √©cran depuis le client...</p><p> On consid√®re une m√©thode <code>foo(String)</code> dans <code>ClientManager</code> et une m√©thode <code>bar(int)</code> dans <code>ServerManager</code>. Effectivement, polymorphisme et h√©ritage ici ne seront pas utiles. Une solution est de d√©clarer 2 fields publiques et statiques (ou alors priv√©, avec un accesseur), un pour le <code>ClientManager</code> et l&#x27;autre pour le <code>ServerManager</code>, de les initialiser chacun √† l&#x27;aide de la m√©thode <code>(un)safeRunWhenOn</code>. Puis ensuite de les appeler quand bon vous semble dans une classe elle-m√™me annot√©e <code>@OnlyIn</code> avec la <code>Dist</code> correspondante, ou bien en utilisant √† nouveau la m√©thode <code>(un)safeRunWhenOn</code>.</p><p>Vous pouvez √©galement profiter de l&#x27;interface <code>SidedManager</code> cr√©√©e plus t√¥t pour donner un acc√®s s√ªr aux m√©thodes communes et publiques des deux <code>Manager</code>s :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">package fr.lmf.distexecutor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import fr.lmf.distexecutor.SidedManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import fr.lmf.distexecutor.client.ClientManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import fr.lmf.distexecutor.server.ServerManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.minecraftforge.api.distmarker.Dist;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.minecraftforge.api.distmarker.OnlyIn;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.minecraftforge.fml.DistExecutor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.minecraftforge.fml.common.Mod;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Mod(&quot;distexecutorexample&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class DistExecutorMod {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @OnlyIn(Dist.CLIENT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static ClientManager clientManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @OnlyIn(Dist.DEDICATED_SERVER)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static ServerManager serverManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static SidedManager currentManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DistExecutorMod() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DistExecutor.unsafeRunWhenOn(Dist.CLIENT, () -&gt; () -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            clientManager = new ClientManager();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            clientManager.foo(&quot;foobar&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DistExecutor.unsafeRunWhenOn(Dist.DEDICATED_SERVER, () -&gt; () -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            serverManager = new ServerManager();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            serverManager.bar(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        currentManager = DistExecutor.unsafeRunForDist(() -&gt; DistExecutorMod::getClientManager, () -&gt; DistExecutorMod::getServerManager);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        currentManager.init();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @OnlyIn(Dist.CLIENT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static ClientManager getClientManager() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return clientManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @OnlyIn(Dist.DEDICATED_SERVER)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static ServerManager getServerManager() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return serverManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static SidedManager getCurrentManager() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return currentManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copier le code" class="copyButton_Ue-o clean-btn">Copier</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="conclusion">Conclusion<a aria-hidden="true" class="hash-link" href="#conclusion" title="Lien direct vers le titre">‚Äã</a></h2><p>Vous savez maintenant vous servir de l&#x27;annotation <code>@OnlyIn</code> et de la classe <code>DistExecutor</code>. Vous √™tes au courant des erreurs qui peuvent survenir si vous utilisez de mani√®re incorrecte ces classes et que vous appelez de mani√®re non v√©rifi√©e des membres pr√©sent sur une seule distribution du client.</p><p>Ce n&#x27;est pas une notion √©vidente, c&#x27;est pour √ßa que j&#x27;ai essay√© d&#x27;√™tre le plus clair et concis et de donner quelques exemples et quelques tips. Toutefois il existe √©videmment d&#x27;autres mani√®res d&#x27;utiliser ces outils pratique. Ne vous d√©couragez pas au moindre plantage et faites attention √† ce que vous appelez.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags :</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/docs/tags/avance">avanc√©</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Les-Moddeurs-Francais/Forge-Doc/edit/master/docs/advanced/dist-executor.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>√âditer cette page</a></div><div class="col lastUpdated_13-_"><span class="theme-last-updated">Derni√®re mise √† jour<!-- --> par <b>Mysterious_Dev</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Pagination des documents"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/advanced/access-transformer"><div class="pagination-nav__sublabel">Pr√©c√©dent</div><div class="pagination-nav__label">¬´ <!-- -->Access Transformer</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#cest-quoi-une-dist-" class="table-of-contents__link toc-highlight">C&#39;est quoi une <code>Dist</code> ?</a></li><li><a href="#lannotation-onlyin" class="table-of-contents__link toc-highlight">L&#39;annotation <code>@OnlyIn</code></a></li><li><a href="#la-classe-distexecutor" class="table-of-contents__link toc-highlight">La classe <code>DistExecutor</code></a><ul><li><a href="#la-m√©thode-unsaferunfordist" class="table-of-contents__link toc-highlight">La m√©thode <code>(un)safeRunForDist</code></a></li><li><a href="#la-m√©thode-unsaferunwhenon" class="table-of-contents__link toc-highlight">La m√©thode <code>(un)safeRunWhenOn</code></a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentations</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Forge</a></li><li class="footer__item"><a class="footer__link-item" href="/faq/intro">FAQ</a></li></ul></div><div class="col footer__col"><div class="footer__title">Communaut√©</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.lesmoddeursfrancais.fr/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/lesmoddeursfr" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://trello.com/lesmoddeursfrancais" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Trello<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">En plus</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/news">News</a></li><li class="footer__item"><a href="https://github.com/Les-Moddeurs-Francais/Forge-Doc" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2021 - Les Moddeurs Francais</div></div></div></footer></div>
<script src="/assets/js/runtime~main.f2806c10.js"></script>
<script src="/assets/js/main.f90c44be.js"></script>
</body>
</html>